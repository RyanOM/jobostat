<!DOCTYPE html>
<html>

<head>
    <title>JobStat</title>
    <link rel="shortcut icon" type="image/x-icon" href="../../img/favicon.ico"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:300,400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,900' rel='stylesheet' type='text/css'>
    <!-- CSS Libs -->
    <link rel="stylesheet" type="text/css" href="../../bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../../bower_components/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../../bower_components/animate.css/animate.min.css">
    <link rel="stylesheet" type="text/css"
          href="../../bower_components/bootstrap-switch/dist/css/bootstrap3/bootstrap-switch.min.css">
    <link rel="stylesheet" type="text/css" href="../../bower_components/checkbox3/dist/checkbox3.min.css">
    <link rel="stylesheet" type="text/css" href="../../bower_components/datatables/media/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="../../bower_components/datatables/media/css/dataTables.bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../../bower_components/select2/dist/css/select2.min.css">
    <link rel="stylesheet" type="text/css" href="../../bower_components/c3/c3.css">
    <!-- CSS App -->
    <link rel="stylesheet" type="text/css" href="../../css/style.css">
    <link rel="stylesheet" type="text/css" href="../../css/themes/flat-blue.css">
</head>

<body class="flat-blue">
<div class="app-container">
    <div class="row content-container">
        <nav class="navbar navbar-inverse navbar-fixed-top navbar-top">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-expand-toggle">
                        <i class="fa fa-bars icon"></i>
                    </button>
                    <ol class="breadcrumb navbar-breadcrumb">
                        <li class="active">Dashboard</li>
                    </ol>
                    <button type="button" class="navbar-right-expand-toggle pull-right visible-xs">
                        <i class="fa fa-th icon"></i>
                    </button>
                </div>
                <ul class="nav navbar-nav navbar-right">
                    <button type="button" class="navbar-right-expand-toggle pull-right visible-xs">
                        <i class="fa fa-times icon"></i>
                    </button>
                    <li class="dropdown profile">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Bob
                            Jones <span class="caret"></span></a>
                        <ul class="dropdown-menu animated fadeInDown">
                            <li class="profile-img">
                                <img src="../../img/profile/picjumbo.com_HNCK4153_resize.jpg" class="profile-img">
                            </li>
                            <li>
                                <div class="profile-info">
                                    <h4 class="username">Bob Jones</h4>
                                    <p>bob_jones@email.com</p>
                                    <div class="btn-group margin-bottom-2x" role="group">
                                        <button type="button" class="btn btn-default"><a href="user_profile.html"><i
                                                class="fa fa-user"></i> Perfil</a></button>
                                        <button type="button" class="btn btn-default"><a href="home.html"><i
                                                class="fa fa-sign-out"></i> Logout</a></button>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="side-menu sidebar-inverse">
            <nav class="navbar navbar-inverse" role="navigation">
                <div class="side-menu-container">
                    <div class="navbar-header">
                        <a class="navbar-brand" href="dashboard.html">
                            <div class="icon fa fa-line-chart"></div>
                            <div class="title">JobStat</div>
                        </a>
                        <button type="button" class="navbar-expand-toggle pull-right visible-xs">
                            <i class="fa fa-times icon"></i>
                        </button>
                    </div>
                    <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="dashboard.html">
                                <span class="icon fa fa-tachometer"></span><span class="title">Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <a href="topskills.html">
                                <span class="icon fa fa-trophy"></span><span class="title">Top Competências</span>
                            </a>
                        </li>
                        <li>
                            <a href="user_profile.html">
                                <span class="icon fa fa fa-user"></span><span class="title">Meu Perfil</span>
                            </a>
                        </li>
                        <li>
                            <a href="home.html">
                                <span class="icon fa fa fa-sign-out"></span><span class="title">Logout</span>
                            </a>
                        </li>
                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </nav>
        </div>
        <!-- Main Content -->
        <div class="container-fluid">
            <div class="side-body padding-top">
                <div class="row  no-margin-bottom">
                    <div class="col-sm-12 col-xs-12">
                        <h3 class="text-center sub-title"> Comparar competências</h3>
                        <br>
                        <div class="row">
                            <div class="col-sm-6 col-sm-offset-3">
                                <select class="js-example-basic-multiple" multiple="multiple" style="width: 100%">
                                    <option value="Python" selected>Python</option>
                                    <option value="Java" selected>Java</option>
                                    <option value="C++">C++</option>
                                    <option value="C#">C#</option>
                                    <option value="Ruby">Ruby</option>
                                    <option value="Javascript">Javascript</option>
                                    <option value="PHP">PHP</option>
                                    <option value="C">C</option>
                                    <option value="Go">Go</option>
                                    <option value="Perl">Perl</option>
                                    <option value="Scala">Scala</option>
                                    <option value="Haskel">Haskel</option>
                                    <option value="Bash">Bash</option>
                                    <option value="R">R</option>
                                    <option value="Clojure">Clojure</option>
                                    <option value="Swift">Swift</option>
                                    <option value=".NET">.NET</option>
                                    <option value="Lua">Lua</option>
                                    <option value="Delphi">Delphi</option>
                                    <option value="Cobol">Cobol</option>
                                </select>
                                <br>
                                <br>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12 col-sm-10 col-sm-offset-1">
                                <div class="card primary">
                                    <div class="card-jumbotron no-padding" style="background: none !important;">
                                        <div id="chart" style="color: dimgrey"></div>
                                    </div>
                                    <div class="card-body half-padding">
                                        <h4 class="no-margin font-weight-300 text-center">(Crescimento Relativo)</h4>
                                        <div class="clear-both"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12 col-sm-10 col-sm-offset-1">
                                <div class="card primary">
                                    <div id="hccontainer" style="height: 400px; min-width: 310px"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="app-footer">
        <div class="wrapper">
            <span class="pull-right"><a href="#"><i class="fa fa-long-arrow-up"></i></a></span> © 2016, JobStat.
        </div>
    </footer>
    <div>
        <!-- Javascript Libs -->
        <script type="text/javascript" src="../../bower_components/jquery/dist/jquery.min.js"></script>
        <script type="text/javascript" src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="../../bower_components/Chart.js/Chart.js"></script>
        <script type="text/javascript"
                src="../../bower_components/bootstrap-switch/dist/js/bootstrap-switch.min.js"></script>
        <script type="text/javascript" src="../../bower_components/matchHeight/jquery.matchHeight-min.js"></script>
        <script type="text/javascript"
                src="../../bower_components/datatables/media/js/jquery.dataTables.min.js"></script>
        <script type="text/javascript"
                src="../../bower_components/datatables/media/js/dataTables.bootstrap.min.js"></script>
        <script type="text/javascript" src="../../bower_components/select2/dist/js/select2.full.min.js"></script>
        <script type="text/javascript" src="../../bower_components/d3/d3.min.js"></script>
        <script type="text/javascript" src="../../bower_components/c3/c3.min.js"></script>
        <script type="text/javascript" src="../../bower_components/requirejs/require.js"></script>
        <script type="text/javascript" src="../../bower_components/highcharts-release/highstock.js"></script>
        <script type="text/javascript" src="../../bower_components/highcharts-release/modules/exporting.js"></script>
        <!-- Javascript -->
        <script type="text/javascript" src="../../js/app.js"></script>
    </div>

    <!-- HC test-->
    <script>

        var chart;
        var allOfferData;

        $(function () {

            $.getJSON('https://raw.githubusercontent.com/RyanOM/jobstat/master/jobstat_backend/analzed_data/all.json', function (jsonData) {

                allOfferData = jsonData;

                startChart()
            });

            function startChart() {

                chart = Highcharts.chart('hccontainer', {

                    title: {
                        text: 'AAPL Stock Price'
                    },

                    xAxis: {
                        categories: getXAxisValues(allOfferData['data'])
                    },

                    yAxis: {
                        title: {
                            text: '% de vagas'
                        }
                    },

                    tooltip: {
                pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b>%<br/>',
                valueDecimals: 2,
                split: true
            },

                    series: []
                });

                addSkillToChart('ios');
                addSkillToChart('android');
                addSkillToChart('ionic');
                addSkillToChart('phonegap');
                addSkillToChart('cordova');


            }
        });

        function addSkillToChart(skillName) {

            getSkillPercentageFrequency(skillName, function (result) {
                chart.addSeries({
                    name: skillName,
                    data: result,
                    tooltip: {
                        valueDecimals: 2
                    }
                });
            });
        }


        function getJsonValues(json) {
            var res = [];
            for (var key in json) {
                if (!key.includes("-")) {
                    res.push(json[key]);
                }
            }
            return res;
        }

        function getXAxisValues(json) {
            var res = [];
            for (var key in json) {
                res.push(key);
            }
            return res;
        }

        function getSkillPercentageFrequency(skill, callback) {

            $.getJSON("https://raw.githubusercontent.com/RyanOM/jobstat/master/jobstat_backend/analzed_data/" + skill + ".json", function (skillData) {

                skillData = skillData['data'];

                var results = [];
                for (var key in skillData) {
                    if (!key.includes("-")) {
                        var nbOffersPerMonth = allOfferData['data'][key];
                        var skillOffersPerMonth = skillData[key];
                        var percentage = skillOffersPerMonth / nbOffersPerMonth * 100;
                        results.push(percentage);
                    }
                }
                callback(results);
            });
        }

    </script>

    <!-- Generate Chart -->
    <script>

        var skillArray = [];
        var xlabels = [];

        //$.getJSON('./java.json', function(data) {
        $.getJSON('https://raw.githubusercontent.com/RyanOM/jobstat/master/java.json', function (data) {
            var nbData = [];
            nbData.push(data["skill_name"]);

            for (var key in data["data"]) {
                nbData.push(data["data"][key]);
                xlabels.push(key);
            }
            //console.log(nbData);
            skillArray = nbData;
        });


        var chart = c3.generate({
            bindto: '#chart',
            title: 'Skills',
            data: {
                columns: [
                    //['Python', -36, -28, 21, 38, -25],
                    //['Java', -10, -39, 34, 46, 30],
                    skillArray,
                    skillArray
                ]
            },
            axis: {
                x: {
                    type: 'categories',
                    //categories: ['2012', '2013', '2014', '2015', '2016']
                    categories: xlabels
                },
                y: {
                    //max: 40,
                    //min: -40

                }
            },
            grid: {
                y: {
                    lines: [
                        {value: 0}
                    ]
                }
            },
            subchart: {
                show: true
            }
        });

        var arr = [];
        arr = {
            "Python": ['Python', -36, -28, 21, 38, -25],
            "Java": ['Java', -10, -39, 34, 46, 30],
            "C++": ['C++', 3, -32, 11, 33, -21],
            "C#": ['C#', -21, 22, -14, 44, 30],
            "Ruby": ['Ruby', -17, 41, 5, -9, -30],
            "Javascript": ['Javascript', -30, 5, 34, -44, 45],
            "PHP": ['PHP', 42, 28, 47, -33, -27],
            "C": ['C', 48, 36, 31, -18, 35],
            "Go": ['Go', -46, -35, 34, 9, 14],
            "Perl": ['Perl', -34, -22, 31, 45, 18],
            "Scala": ['Scala', 7, 12, 48, 35, 28],
            "Haskel": ['Haskel', -7, -24, -1, 23, 2],
            "Bash": ['Bash', 35, -34, 40, 41, -1],
            "R": ['R', -19, 47, -35, 13, -7],
            "Clojure": ['Clojure', -18, -27, 34, -29, -47],
            "Swift": ['Swift', 3, 40, -10, 3, 13],
            ".NET": ['.NET', 11, 33, 40, -26, 45],
            "Lua": ['Lua', 50, -27, 40, 4, -19],
            "Delphi": ['Delphi', -18, -36, -30, 18, 20],
            "Cobol": ['Cobol', -27, 43, 12, 16, 3],
        };


        var $eventLog = $(".js-event-log");
        var $eventSelect = $(".js-example-basic-multiple");

        $eventSelect.on("select2:select", function (e) {
            console.log(e.params.data.id);
            chart.load({
                columns: [
                    arr[e.params.data.id],
                    skillArray
                ]
            });
        });

        $eventSelect.on("select2:unselect", function (e) {
            chart.unload({
                ids: e.params.data.id,
            });
        });


        function month_to_years(json_skill) {
            var pop = json_skill["data"];
            var year_dic = {};

            for (var key in pop) {
                var year = key.substring(0, 4);
                var keyvalue = pop[key];

                if (year in year_dic) {
                    year_dic[year] = year_dic[year] + keyvalue;
                } else {
                    year_dic[year] = keyvalue;
                }
            }
            return year_dic;

        }


    </script>
</div>
</body>

</html>
