<!DOCTYPE html>
<html>

<head>
    <title>JobStat</title>
    <link rel="shortcut icon" type="image/x-icon" href="../../img/favicon.ico"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:300,400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,900' rel='stylesheet' type='text/css'>
    <!-- CSS Libs -->
    <link rel="stylesheet" type="text/css" href="../../lib/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/animate.min.css">
    <link rel="stylesheet" type="text/css"
          href="../../lib/css/bootstrap-switch.min.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/checkbox3.min.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/dataTables.bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/select2.min.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/c3.css">
    <!-- CSS App -->
    <link rel="stylesheet" type="text/css" href="../../css/style.css">
    <link rel="stylesheet" type="text/css" href="../../css/themes/flat-blue.css">
</head>

<body class="flat-blue">
<div class="app-container">
    <div class="row content-container">
        <nav class="navbar navbar-inverse navbar-fixed-top navbar-top">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-expand-toggle">
                        <i class="fa fa-bars icon"></i>
                    </button>
                    <ol class="breadcrumb navbar-breadcrumb">
                        <li class="active">Dashboard</li>
                    </ol>
                    <button type="button" class="navbar-right-expand-toggle pull-right visible-xs">
                        <i class="fa fa-th icon"></i>
                    </button>
                </div>
                <ul class="nav navbar-nav navbar-right">
                    <button type="button" class="navbar-right-expand-toggle pull-right visible-xs">
                        <i class="fa fa-times icon"></i>
                    </button>
                    <li class="dropdown profile">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Bob
                            Jones <span class="caret"></span></a>
                        <ul class="dropdown-menu animated fadeInDown">
                            <li class="profile-img">
                                <img src="../../img/profile/picjumbo.com_HNCK4153_resize.jpg" class="profile-img">
                            </li>
                            <li>
                                <div class="profile-info">
                                    <h4 class="username">Bob Jones</h4>
                                    <p>bob_jones@email.com</p>
                                    <div class="btn-group margin-bottom-2x" role="group">
                                        <button type="button" class="btn btn-default"><a href="user_profile.html"><i
                                                class="fa fa-user"></i> Perfil</a></button>
                                        <button type="button" class="btn btn-default"><a href="home.html"><i
                                                class="fa fa-sign-out"></i> Logout</a></button>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="side-menu sidebar-inverse">
            <nav class="navbar navbar-inverse" role="navigation">
                <div class="side-menu-container">
                    <div class="navbar-header">
                        <a class="navbar-brand" href="dashboard.html">
                            <div class="icon fa fa-line-chart"></div>
                            <div class="title">JobStat</div>
                        </a>
                        <button type="button" class="navbar-expand-toggle pull-right visible-xs">
                            <i class="fa fa-times icon"></i>
                        </button>
                    </div>
                    <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="dashboard.html">
                                <span class="icon fa fa-tachometer"></span><span class="title">Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <a href="topskills.html">
                                <span class="icon fa fa-trophy"></span><span class="title">Top Competências</span>
                            </a>
                        </li>
                        <li>
                            <a href="user_profile.html">
                                <span class="icon fa fa fa-user"></span><span class="title">Meu Perfil</span>
                            </a>
                        </li>
                        <li>
                            <a href="home.html">
                                <span class="icon fa fa fa-sign-out"></span><span class="title">Logout</span>
                            </a>
                        </li>
                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </nav>
        </div>
        <!-- Main Content -->
        <div class="container-fluid">
            <div class="side-body padding-top">
                <div class="row  no-margin-bottom">
                    <div class="col-sm-12 col-xs-12">
                        <h3 class="text-center sub-title"> Comparar competências</h3>
                        <br>
                        <div class="row">
                            <div class="col-sm-6 col-sm-offset-3">
                                <select class="js-example-basic-multiple" multiple="multiple" style="width: 100%">
                                    <option value="Javascript" selected>Javascript</option>
                                    <option value="Java" selected>Java</option>
                                </select>
                                <br>
                                <br>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12 col-sm-10 col-sm-offset-1">
                                <div class="card primary">
                                    <div id="hccontainer" style="height: 400px; min-width: 310px"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="app-footer">
        <div class="wrapper">
            <span class="pull-right"><a href="#"><i class="fa fa-long-arrow-up"></i></a></span> © 2016, JobStat.
        </div>
    </footer>
    <div>
        <!-- Javascript Libs -->
        <script type="text/javascript" src="../../lib/js/jquery.min.js"></script>
        <script type="text/javascript" src="../../lib/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="../../lib/js/Chart.js"></script>
        <script type="text/javascript"
                src="../../lib/js/bootstrap-switch.min.js"></script>
        <script type="text/javascript" src="../../lib/js/jquery.matchHeight.js"></script>
        <script type="text/javascript"
                src="../../lib/js/jquery.dataTables.min.js"></script>
        <script type="text/javascript"
                src="../../lib/js/dataTables.bootstrap.min.js"></script>
        <script type="text/javascript" src="../../lib/js/select2.full.min.js"></script>
        <script type="text/javascript" src="../../lib/js/d3.js"></script>
        <script type="text/javascript" src="../../lib/js/c3.min.js"></script>
        <script type="text/javascript" src="../../lib/js/require.js"></script>
        <script type="text/javascript" src="../../lib/js/highstock.js"></script>
        <script type="text/javascript" src="../../lib/js/exporting.src.js"></script>
        <!-- Javascript -->
        <script type="text/javascript" src="../../js/app.js"></script>
    </div>

    <!-- Generate HighChart-->
    <script>
        var chart;
        var allOfferData;

        <!-- Add names to select2 -->
        var files = $.getJSON('https://api.github.com/repos/ryanOM/jobstat/contents/jobstat_backend/analyzed_data', function (jsonData) {

            var data = [];
            for (var i = 0; i < jsonData.length; i++) {
                var obj = jsonData[i];
                console.log(obj['name']);
                if (obj['name'] != "all.json" && obj['name'] != "java.json" && obj['name'] != "javascript.json") {
                    var skillName = obj['name'].split('.json')[0];
                    var d = {
                        'id': skillName,
                        'text': skillName[0].toUpperCase() + skillName.substr(1)
                    };
                    data.push(d);
                }
            }
            $(".js-example-basic-multiple").select2({
                data: data
            });
        });

        $(function () {

            $.getJSON('https://raw.githubusercontent.com/RyanOM/jobstat/master/jobstat_backend/analyzed_data/all.json', function (jsonData) {

                allOfferData = jsonData;

                startChart()
            });

            function startChart() {

                chart = Highcharts.chart('hccontainer', {

                    title: {
                        text: 'Ofertas de Emprego Publicadas'
                    },

                    xAxis: {
                        categories: getXAxisValues(allOfferData['data'])
                    },

                    yAxis: {
                        title: {
                            text: 'Porcentagem de ofertas de emprego correspondentes (%)'
                        }
                    },

                    tooltip: {
                pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b>%<br/>',
                valueDecimals: 2,
                split: true
            },

                    series: []
                });

                // Add default skills to chart
                addSkillToChart('javascript');
                addSkillToChart('java');
            }
        });

        function addSkillToChart(skillName) {

            getSkillPercentageFrequency(skillName, function (result) {
                chart.addSeries({
                    name: skillName,
                    data: result,
                    tooltip: {
                        valueDecimals: 2
                    }
                });
            });
        }


        function getJsonValues(json) {
            var res = [];
            for (var key in json) {
                if (!key.includes("-")) {
                    res.push(json[key]);
                }
            }
            return res;
        }

        function getXAxisValues(json) {
            var res = [];
            for (var key in json) {
                res.push(key);
            }
            return res;
        }

        function getSkillPercentageFrequency(skill, callback) {

            $.getJSON("https://raw.githubusercontent.com/RyanOM/jobstat/master/jobstat_backend/analyzed_data/" + skill.replace('#', '%23') + ".json", function (skillData) {

                skillData = skillData['data'];

                var results = [];
                for (var key in skillData) {
                    if (!key.includes("-")) {
                        var nbOffersPerMonth = allOfferData['data'][key];
                        var skillOffersPerMonth = skillData[key];
                        var percentage = skillOffersPerMonth / nbOffersPerMonth * 100;
                        results.push(percentage);
                    }
                }
                callback(results);
            });
        }

        /*
            Chart Series Manipulation
         */

        var $eventSelect = $(".js-example-basic-multiple");

        // Add selected skill to chart
        $eventSelect.on("select2:select", function (e) {
            var selectedSkill = String(e.params.data.id).toLowerCase();
            addSkillToChart(selectedSkill);
        });

        // Remove unselected skill from chart
        $eventSelect.on("select2:unselect", function (e) {
            var unselectedSkill = String(e.params.data.id).toLowerCase();
            var seriesLength = chart.series.length;
            for(var i = seriesLength - 1; i > -1; i--) {
                if(chart.series[i].name ==unselectedSkill) {
                    chart.series[i].remove();
                }
            }
        });


    </script>
</div>
</body>

</html>
